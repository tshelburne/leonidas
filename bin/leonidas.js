(function(){var f=window.modules||[],a=null;f.leonidas__client=function(){null===a&&(a=function(a,g){this.id=a;this.state=g});return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commander=function(){if(null===a){var c,g,p,e;c=require("leonidas/commands/command");g=require("leonidas/commands/organizer");p=require("leonidas/commands/processor");e=require("leonidas/commands/synchronizer");var b=function(d,b,e,a){this.client=d;this.organizer=b;this.processor=e;this.synchronizer=a};b.create=function(d,b,a){var c;c=new g;b=new p(b);a=new e(a,d,c,b);return new this(d,c,b,a)};b.prototype.startSync=function(d,b){null==d&&(d=
1E3);null==b&&(b=5E3);this.pushInterval=setInterval(this.synchronizer.push,d);return this.pullInterval=setInterval(this.synchronizer.pull,b)};b.prototype.stopSync=function(){clearInterval(this.pushInterval);return clearInterval(this.pullInterval)};b.prototype.forceSync=function(){this.synchronizer.push();return this.synchronizer.pull()};b.prototype.issueCommand=function(b,e){var a;a=new c(b,e,this.client.id);this.organizer.local.addCommand(a);return this.processor.runCommand(a)};a=b}return a};window.modules=
f})();(function(){var f=window.modules||[],a=null;f.leonidas__commands__command=function(){if(null===a){var c=function(a,p,e,b){this.name=a;this.data=p;this.clientId=e;null==b&&(b=null);this.timestamp=null!=b?b:new Date};c.prototype.toHash=function(){return{name:this.name,data:this.data,clientId:this.clientId,timestamp:this.timestamp.getTime()}};a=c}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commands__command_list=function(){if(null===a){var c=function(){this.commands=[]},g;c.prototype.addCommand=function(a){this.commands.push(a);return g(this.commands)};c.prototype.addCommands=function(a){var e,b,d,k;k=[];b=0;for(d=a.length;b<d;b++)e=a[b],k.push(this.addCommand(e));return k};c.prototype.commandsThrough=function(a){var e,b,d,k,c;k=this.commands;c=[];b=0;for(d=k.length;b<d;b++)e=k[b],e.timestamp<=a&&c.push(e);return c};c.prototype.commandsSince=
function(a){var e,b,d,k,c;k=this.commands;c=[];b=0;for(d=k.length;b<d;b++)e=k[b],e.timestamp>a&&c.push(e);return c};g=function(a){return a.sort(function(e,b){return e.timestamp>b.timestamp?1:-1})};a=c}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commands__handler=function(){if(null===a){var c=function(){};c.prototype.handles=function(a){return a.name===this.name};c.prototype.run=function(){throw Error("Every CommandHandler should override #run.");};c.prototype.rollback=function(){throw Error("Every CommandHandler should override #rollback.");};a=c}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commands__organizer=function(){if(null===a){var c;c=require("leonidas/commands/command_list");var g=function(){this.local=new c;this.external=new c},f;g.prototype.commandsThrough=function(e){var b,d,a,c,g;c=this.allCommands();g=[];d=0;for(a=c.length;d<a;d++)b=c[d],b.timestamp<=e&&g.push(b);return g};g.prototype.commandsSince=function(e){var b,d,a,c,g;c=this.allCommands();g=[];d=0;for(a=c.length;d<a;d++)b=c[d],b.timestamp>e&&g.push(b);return g};
g.prototype.allCommands=function(){var a,b,d,c,g;c=this.local.commands;g=[];b=0;for(d=c.length;b<d;b++)a=c[b],g.push(a);c=this.external.commands;b=0;for(d=c.length;b<d;b++)a=c[b],g.push(a);return f(g)};f=function(a){return a.sort(function(b,a){return b.timestamp>a.timestamp?1:-1})};a=g}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commands__processor=function(){if(null===a){var c=function(a){this.handlers=a};c.prototype.runCommand=function(a){var c,e,b,d,k;d=this.handlers;k=[];e=0;for(b=d.length;e<b;e++)c=d[e],c.handles(a)?k.push(c.run(a)):k.push(void 0);return k};c.prototype.runCommands=function(a){var c,e,b,d;d=[];e=0;for(b=a.length;e<b;e++)c=a[e],d.push(this.runCommand(c));return d};c.prototype.rollbackCommand=function(a){var c,e,b,d,k;d=this.handlers;k=[];e=0;for(b=
d.length;e<b;e++)c=d[e],c.handles(a)?k.push(c.rollback(a)):k.push(void 0);return k};c.prototype.rollbackCommands=function(a){var c,e,b,d;d=[];e=0;for(b=a.length;e<b;e++)c=a[e],d.push(this.rollbackCommand(c));return d};a=c}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null;f.leonidas__commands__synchronizer=function(){if(null===a){var c,f=function(a,b){return function(){return a.apply(b,arguments)}};require("lib/reqwest");c=require("leonidas/commands/command");var p=function(a,b,d,c){this.syncUrl=a;this.client=b;this.organizer=d;this.processor=c;this.pull=f(this.pull,this);this.push=f(this.push,this);this.stableTimestamp=new Date(0);this.externalClients=[];this.syncedTimestamp=new Date(0)};p.prototype.push=function(){var a,
b=this,d,c,f,g;f=this.organizer.local.commandsSince(this.syncedTimestamp);g=[];d=0;for(c=f.length;d<c;d++)a=f[d],g.push(a);d=reqwest;c=""+this.syncUrl;f=this.client.id;var p=this.externalClients,r,s,t;t=[];r=0;for(s=g.length;r<s;r++)a=g[r],t.push(a.toHash());return d({url:c,type:"json",method:"post",data:{clientId:f,clients:p,commands:t},error:function(){return console.log("push error")},success:function(){return b.syncedTimestamp=g[g.length-1].timestamp}})};p.prototype.pull=function(){var a=this;
return reqwest({url:""+this.syncUrl,type:"json",method:"get",data:{clientId:this.client.id,clients:this.externalClients},error:function(){return console.log("pull error")},success:function(b){var d,f,g,p,w;p=b.data.commands;w=[];f=0;for(g=p.length;f<g;f++)d=p[f],w.push(new c(d.name,d.data,d.connection,new Date(d.timestamp)));a.processor.rollbackCommands(a.organizer.commandsSince(a.stableTimestamp).reverse());a.organizer.external.addCommands(w);a.processor.runCommands(a.organizer.commandsSince(a.stableTimestamp));
a.externalClients=b.data.currentClients;return a.stableTimestamp=b.data.stableTimestamp}})};a=p}return a};window.modules=f})();
(function(){var f=window.modules||[],a=null,c=function(){var a=function(){function a(h){x=h}function c(a,d){this.o=a;this.fn=d;b.apply(this,arguments)}function b(h,b){function c(a){h.timeout&&clearTimeout(e.timeout);for(e.timeout=null;0<e._completeHandlers.length;)e._completeHandlers.shift()(a)}function f(a,h,b){e._responseArgs.resp=a;e._responseArgs.msg=h;e._responseArgs.t=b;for(e._erred=!0;0<e._errorHandlers.length;)e._errorHandlers.shift()(a,h,b);c(a)}this.url="string"==typeof h?h:h.url;this.timeout=
null;this._fulfilled=!1;this._fulfillmentHandlers=[];this._errorHandlers=[];this._completeHandlers=[];this._erred=!1;this._responseArgs={};var e=this,g;if(!(g=h.type))g=(g=this.url.match(/\.(json|jsonp|html|xml)(\?|$)/))?g[1]:"js";var k=g;b=b||function(){};h.timeout&&(this.timeout=setTimeout(function(){e.abort()},h.timeout));h.success&&this._fulfillmentHandlers.push(function(){h.success.apply(h,arguments)});h.error&&this._errorHandlers.push(function(){h.error.apply(h,arguments)});h.complete&&this._completeHandlers.push(function(){h.complete.apply(h,
arguments)});var n;var J=function(a){var h=E.dataFilter(a.responseText,k);if(h=a.responseText=h)switch(k){case "json":try{a=t.JSON?t.JSON.parse(h):eval("("+h+")")}catch(d){return f(a,"Could not parse JSON in response",d)}break;case "js":a=eval(h);break;case "html":a=h;break;case "xml":a=a.responseXML&&a.responseXML.parseError&&a.responseXML.parseError.errorCode&&a.responseXML.parseError.reason?null:a.responseXML}e._responseArgs.resp=a;e._fulfilled=!0;for(b(a);0<e._fulfillmentHandlers.length;)e._fulfillmentHandlers.shift()(a);
c(a)},j=this.o,m=(j.method||"GET").toUpperCase(),u="string"===typeof j?j:j.url;g=!1!==j.processData&&j.data&&"string"!==typeof j.data?d.toQueryString(j.data):j.data||null;var q;if(("jsonp"==j.type||"GET"==m)&&g)u=u+(/\?/.test(u)?"&":"?")+g,g=null;if("jsonp"==j.type){n=u;g=K++;q=j.jsonpCallback||"callback";var m=j.jsonpCallbackName||d.getcallbackPrefix(g),u=RegExp("((^|\\?|&)"+q+")=([^&]+)"),r=n.match(u),l=F.createElement("script"),s=0,w=-1!==navigator.userAgent.indexOf("MSIE 10.0");r?"?"===r[3]?n=
n.replace(u,"$1="+m):m=r[3]:n=n+(/\?/.test(n)?"&":"?")+(q+"="+m);t[m]=a;l.type="text/javascript";l.src=n;l.async=!0;"undefined"!==typeof l.onreadystatechange&&!w&&(l.event="onclick",l.htmlFor=l.id="_reqwest_"+g);l.onload=l.onreadystatechange=function(){if(l[y]&&"complete"!==l[y]&&"loaded"!==l[y]||s)return!1;l.onload=l.onreadystatechange=null;l.onclick&&l.onclick();j.success&&j.success(x);x=void 0;B.removeChild(l);s=1};B.appendChild(l);n={abort:function(){l.onload=l.onreadystatechange=null;j.error&&
j.error({},"Request is aborted: timeout",{});x=void 0;B.removeChild(l);s=1}}}else{q=L();q.open(m,u,!0);m=j.headers||{};m.Accept=m.Accept||z.accept[j.type]||z.accept["*"];!j.crossOrigin&&!m[G]&&(m[G]=z.requestedWith);m[H]||(m[H]=j.contentType||z.contentType);for(n in m)m.hasOwnProperty(n)&&q.setRequestHeader(n,m[n]);"undefined"!==typeof j.withCredentials&&"undefined"!==typeof q.withCredentials&&(q.withCredentials=!!j.withCredentials);var v=this;q.onreadystatechange=function(){if(v._aborted)return f(v.request);
v.request&&4==v.request[y]&&(v.request.onreadystatechange=M,N.test(v.request.status)?J(v.request):f(v.request))};j.before&&j.before(q);q.send(g);n=q}this.request=n}function d(a,b){return new c(a,b)}function f(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function g(a,b){var c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,f(a.attributes.value&&a.attributes.value.specified?a.value:a.text))},A;if(!a.disabled&&c)switch(d){case "input":/reset|button|image|file/i.test(a.type)||(e=/checkbox/i.test(a.type),
d=/radio/i.test(a.type),A=a.value,(!e&&!d||a.checked)&&b(c,f(e&&""===A?"on":A)));break;case "textarea":b(c,f(a.value));break;case "select":if("select-one"===a.type.toLowerCase())e(0<=a.selectedIndex?a.options[a.selectedIndex]:null);else for(d=0;a.length&&d<a.length;d++)a.options[d].selected&&e(a.options[d])}}function D(){var a,b;for(b=0;b<arguments.length;b++){a=arguments[b];/input|select|textarea/i.test(a.tagName)&&g(a,this);for(var c=["input","select","textarea"],d=void 0,e=void 0,f=void 0,d=0;d<
c.length;d++){f=a[I](c[d]);for(e=0;e<f.length;e++)g(f[e],this)}}}function w(){return d.toQueryString(d.serializeArray.apply(null,arguments))}function r(){var a={};D.apply(function(b,c){b in a?(a[b]&&!C(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments);return a}function s(a,b,c,d){var e,f,g=/\[\]$/;if(C(b))for(e=0;b&&e<b.length;e++)f=b[e],c||g.test(a)?d(a,f):s(a+"["+("object"===typeof f?e:"")+"]",f,c,d);else if("[object Object]"===b.toString())for(e in b)s(a+"["+e+"]",b[e],c,d);else d(a,b)}var t=
window,F=document,N=/^20\d$/,I="getElementsByTagName",y="readyState",H="Content-Type",G="X-Requested-With",B=F[I]("head")[0],K=0,O="reqwest_"+ +new Date,x,M=function(){},C="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},z={contentType:"application/x-www-form-urlencoded",requestedWith:"XMLHttpRequest",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",
js:"application/javascript, text/javascript"}},L=t.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},E={dataFilter:function(a){return a}};c.prototype={abort:function(){this._aborted=!0;this.request.abort()},retry:function(){b.call(this,this.o,this.fn)},then:function(a,b){this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b));
return this},always:function(a){this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a);return this},fail:function(a){this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a);return this}};d.serializeArray=function(){var a=[];D.apply(function(b,c){a.push({name:b,value:c})},arguments);return a};d.serialize=function(){if(0===arguments.length)return"";var a,b=Array.prototype.slice.call(arguments,0);(a=b.pop())&&a.nodeType&&
b.push(a)&&(a=null);a&&(a=a.type);return("map"==a?r:"array"==a?d.serializeArray:w).apply(null,b)};d.toQueryString=function(a,b){var c,d=b||!1,e=[],f=encodeURIComponent,g=function(a,b){b="function"===typeof b?b():null==b?"":b;e[e.length]=f(a)+"="+f(b)};if(C(a))for(c=0;a&&c<a.length;c++)g(a[c].name,a[c].value);else for(c in a)s(c,a[c],d,g);return e.join("&").replace(/%20/g,"+")};d.getcallbackPrefix=function(){return O};d.compat=function(a,b){a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&
(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp));return new c(a,b)};d.ajaxSetup=function(a){a=a||{};for(var b in a)E[b]=a[b]};return d};"undefined"!=typeof module&&module.exports?module.exports=a():"function"==typeof define&&define.amd?define(a):this.reqwest=a();!0};f.lib__reqwest=function(){null===a&&(a=c());return a};window.modules=f})();
(function(){var f=window.modules||[];window.require=function(a){a=a.replace(/\//g,"__");-1===a.indexOf("__")&&(a="__"+a);return null===f[a]?null:f[a]()}})();

